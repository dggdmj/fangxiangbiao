var Login=function(){var i=function(){$(".login_btn").click(function(j){$("form.login_form").submit()})};var e=function(){$(".verifyimg_event").click(function(j){$(".verifyimg_event").attr("src","/static/assets/global/img/loading-spinner-grey.gif");$.post("/manager/Login/refresh_verify",function(k,m,l){if(k){$(".verifyimg_event").attr("src",k)}else{$(".alert_modal").find(".modal-body").text("验证码获取失败");$(".alert_modal").modal("show")}})})};var d=function(){var j=false;if(typeof(allow_verify)!="undefined"){if(allow_verify){j=true}}$(".login-form").validate({errorElement:"span",errorClass:"help-block",focusInvalid:true,rules:{username:{required:true},password:{required:true},verify:{required:j}},messages:{username:{required:"用户名为必填项"},password:{required:"密码为必填项"},verify:{required:"验证码为必填项"}},invalidHandler:function(l,k){$(".alert-danger",$(".login-form")).show();if(localStorage.nine_login==2&&window_width<=767){$(".login .content").removeClass("content_nine");if(allow_verify){$(".login .content").addClass("content_nine_verify_error")}else{$(".login .content").addClass("content_nine_error")}}},highlight:function(k){$(k).closest(".form-group").addClass("has-error");if(localStorage.nine_login==2&&window_width<=767){$(".login .content").removeClass("content_nine");if(allow_verify){$(".login .content").addClass("content_nine_verify_error")}else{$(".login .content").addClass("content_nine_error")}}},success:function(k){k.closest(".form-group").removeClass("has-error");k.remove();if(localStorage.nine_login==2&&window_width<=767){$(".login .content").removeClass("content_nine_verify_error");$(".login .content").removeClass("content_nine_error");$(".login .content").addClass("content_nine")}},errorPlacement:function(k,l){k.insertAfter(l.closest(".input-icon"))},submitHandler:function(k){if(allow_login_error){if(g()){}else{return false}}App.blockUI({boxed:true,message:"登录中..."});localStorage.prev_login_username=$("#username").val();$.post(k.action,$(k).serialize(),function(p,s,r){App.unblockUI();if(p.status){App.blockUI({boxed:true,message:"页面跳转中..."});localStorage.login_error_times=0;location.href=p["url"]}else{switch(p.type){case 0:$(".alert_modal").find(".modal-body").text(p.info);$(".alert_modal").modal("show");break;case 1:$(".verifyimg_event").attr("src",p["src"]);b("输入的验证码有误");break;case 2:case 3:if(allow_login_error){if(localStorage.login_error_times){}else{localStorage.login_error_times=0}if(localStorage.login_error_times>=login_error_times){var n=new Date();var o=n.getTime();var m=o+1000*error_wait_time;var q=error_wait_time/60;localStorage.error_wait_time=m;$(".alert_modal").find(".modal-body").html("登录失败次数过多，已达到"+login_error_times+'次，请等待：<b style="color:#f00">'+q+"</b>分钟后再尝试");$(".alert_modal").modal("show");localStorage.login_error_times=0}else{localStorage.login_error_times=parseInt(localStorage.login_error_times)+1;var l=login_error_times-localStorage.login_error_times;$(".alert_modal").find(".modal-body").html(p["info"]+'，登录失败，还剩：<b style="color:#f00">'+l+"</b>次机会");$(".alert_modal").modal("show")}$(".verifyimg_event").attr("src",p["src"]);b("请重新输入验证码");return false}$(".alert_modal").find(".modal-body").text(p.info);$(".alert_modal").modal("show");$(".verifyimg_event").attr("src",p["src"]);b("请重新输入验证码");break}}})}});$(".login-form input").keypress(function(k){if(k.which==13){$(".login-form").submit();return false}})};var b=function(j){$(".verify_input").parents(".form-group:first").removeClass("has-error");$(".verify_input").parents(".form-group:first").addClass("has-error");$(".verify_input").parents(".form-group:first").find("span.help-block").remove();$(".verify_input").parents(".form-group:first").append('<span class="help-block">'+j+"</span>");$(".verify_input").focus();$(".verify_input").unbind("keydown");$(".verify_input").keydown(function(k){$(".verify_input").parents(".form-group:first").find("span.help-block").remove();$(".verify_input").parents(".form-group:first").removeClass("has-error")})};var g=function(){if(localStorage.error_wait_time){var j=new Date();var l=j.getTime();if(localStorage.error_wait_time>l){var k=localStorage.error_wait_time-l;var m=parseInt(k/1000/60);$(".alert_modal").find(".modal-body").html('登录失败次数过多，请等待：<b style="color:#f00">'+m+"</b>分钟后再尝试");$(".alert_modal").modal("show");return false}else{return true}}else{return true}};var c=function(){if(record_login_username&&localStorage.prev_login_username){$("#username").val(localStorage.prev_login_username)}};var f=function(){if(nine_login){if(localStorage.nine_login==2&&window_width<=767){a()}else{h()}$(".nine_btn").click(function(j){if(localStorage.nine_login==1){a()}else{h()}})}};var a=function(){$(".login_btn").hide();$(".password_group").hide();$("#password").val("nine");localStorage.nine_login=2;$(".nine_btn").text("使用传统方式登录");$(".content_event").addClass("content_nine");$(".login-form input").unbind("keypress");$(".login_top_divide_event").addClass("login_top_divide_nine");$("#nine_box").addClass("visible-xs");$("#nine_box").show()
};var h=function(){$(".login_btn").show();$(".password_group").show();$("#password").val("");$(".nine_password").val("");localStorage.nine_login=1;$(".nine_btn").text("使用九宫格方式登录");$(".content_event").removeClass("content_nine");$(".login-form input").keypress(function(j){if(j.which==13){$(".login-form").submit();return false}});$(".login_top_divide_event").removeClass("login_top_divide_nine");$("#nine_box").removeClass("visible-xs");$("#nine_box").hide();if(localStorage.nine_login==1&&window_width<=767){$(".login .content").removeClass("content_nine_verify_error");$(".login .content").removeClass("content_nine_error");$(".login .content").removeClass("content_nine")}};return{init:function(){d();i();e();c();f()}}}();jQuery(document).ready(function(){Login.init()});